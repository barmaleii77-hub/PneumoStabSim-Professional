# üöÄ START PHASE 2: MAINWINDOW REFACTORING

## ‚ö° –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

–í—ã –≥–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –§–∞–∑—É 2 —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ PneumoStabSim!

---

## ‚úÖ –ü–†–ï–î–ü–û–°–´–õ–ö–ò

**–§–∞–∑–∞ 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞:**
- ‚úÖ GraphicsPanel —Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ 12 –º–æ–¥—É–ª–µ–π
- ‚úÖ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —É–º–µ–Ω—å—à–µ–Ω —Å 2662 ‚Üí 300 —Å—Ç—Ä–æ–∫
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –§–∞–∑–∞ 1: GraphicsPanel   ‚úÖ 100%  ‚îÇ
‚îÇ  –§–∞–∑–∞ 2: MainWindow      ‚è≥   0%  ‚îÇ
‚îÇ  –§–∞–∑–∞ 3: GeometryPanel   üìã   0%  ‚îÇ
‚îÇ  –§–∞–∑–∞ 4: SimLoop         üìã   0%  ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ  –û–ë–©–ò–ô –ü–†–û–ì–†–ï–°–°:         ‚ñà‚ñë‚ñë‚ñë 25% ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ –¶–ï–õ–¨ –§–ê–ó–´ 2

–†–∞–∑–¥–µ–ª–∏—Ç—å `main_window.py` (~1200 —Å—Ç—Ä–æ–∫) –Ω–∞ –º–æ–¥—É–ª–∏:

```
src/ui/main_window/
‚îú‚îÄ‚îÄ main_window.py          # Coordinator (~300 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ ui_setup.py             # UI construction (~400 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ qml_bridge.py           # Python‚ÜîQML (~300 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ signals_router.py       # Signal routing (~200 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ state_sync.py           # State sync (~250 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ menu_actions.py         # Menu/toolbar (~150 —Å—Ç—Ä–æ–∫)
```

---

## üîß –®–ê–ì–ò –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### 1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```bash
mkdir src/ui/main_window
cd src/ui/main_window
```

### 2. –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ —Ñ–∞–π–ª—ã
```bash
# Windows PowerShell
New-Item -ItemType File -Path __init__.py
New-Item -ItemType File -Path README.md
New-Item -ItemType File -Path ui_setup.py
New-Item -ItemType File -Path qml_bridge.py
New-Item -ItemType File -Path signals_router.py
New-Item -ItemType File -Path state_sync.py
New-Item -ItemType File -Path menu_actions.py
New-Item -ItemType File -Path main_window.py

# Linux/macOS
touch __init__.py README.md ui_setup.py qml_bridge.py
touch signals_router.py state_sync.py menu_actions.py main_window.py
```

### 3. –°–ª–µ–¥–æ–≤–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–º—É –ø–ª–∞–Ω—É
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω:
code REFACTORING_PHASE2_MAINWINDOW_PLAN.md

# –ò–ª–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏:
cat REFACTORING_PHASE2_MAINWINDOW_PLAN.md
```

---

## üìö –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù

### –®–∞–≥ 2.1: –í—ã–¥–µ–ª–∏—Ç—å UI Setup (~400 —Å—Ç—Ä–æ–∫)
**–§–∞–π–ª:** `ui_setup.py`

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞:**
- `_setup_central()`
- `_setup_tabs()`
- `_setup_menus()`
- `_setup_toolbar()`
- `_setup_status_bar()`

### –®–∞–≥ 2.2: –í—ã–¥–µ–ª–∏—Ç—å QML Bridge (~300 —Å—Ç—Ä–æ–∫)
**–§–∞–π–ª:** `qml_bridge.py`

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞:**
- `_setup_qml_3d_view()`
- `_invoke_qml_function()`
- `_set_qml_property()`
- `_batch_update()`

### –®–∞–≥ 2.3: –í—ã–¥–µ–ª–∏—Ç—å Signals Router (~200 —Å—Ç—Ä–æ–∫)
**–§–∞–π–ª:** `signals_router.py`

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞:**
- `_wire_panel_signals()`
- `_connect_simulation_signals()`

### –®–∞–≥ 2.4: –í—ã–¥–µ–ª–∏—Ç—å State Sync (~250 —Å—Ç—Ä–æ–∫)
**–§–∞–π–ª:** `state_sync.py`

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞:**
- `_update_3d_scene_from_snapshot()`
- `_on_geometry_changed()`
- `_on_animation_changed()`

### –®–∞–≥ 2.5: –í—ã–¥–µ–ª–∏—Ç—å Menu Actions (~150 —Å—Ç—Ä–æ–∫)
**–§–∞–π–ª:** `menu_actions.py`

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞:**
- `_show_about()`
- `_open_file()`
- `_save_file()`
- `_export_data()`

### –®–∞–≥ 2.6: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä (~300 —Å—Ç—Ä–æ–∫)
**–§–∞–π–ª:** `main_window.py`

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```python
from .ui_setup import UISetup
from .qml_bridge import QMLBridge
from .signals_router import SignalsRouter
from .state_sync import StateSync
from .menu_actions import MenuActions

class MainWindow(QMainWindow):
    def __init__(self, use_qml_3d=True):
        super().__init__()

        # –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ UI –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è
        UISetup.setup_central(self)
        UISetup.setup_tabs(self)
        # ...

        # –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ QML –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
        QMLBridge.setup_qml_view(self)

        # –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤
        SignalsRouter.connect_panel_signals(self)
```

---

## ‚è±Ô∏è –í–†–ï–ú–Ø –í–´–ü–û–õ–ù–ï–ù–ò–Ø

| –ó–∞–¥–∞—á–∞ | –í—Ä–µ–º—è | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|--------|-------|-----------|
| –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã | 5 –º–∏–Ω | ‚≠ê |
| UI Setup | 1 —á–∞—Å | ‚≠ê‚≠ê |
| QML Bridge | 1.5 —á–∞—Å–∞ | ‚≠ê‚≠ê‚≠ê |
| Signals Router | 45 –º–∏–Ω | ‚≠ê‚≠ê |
| State Sync | 1 —á–∞—Å | ‚≠ê‚≠ê‚≠ê |
| Menu Actions | 30 –º–∏–Ω | ‚≠ê |
| –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä | 1 —á–∞—Å | ‚≠ê‚≠ê |
| **–ò–¢–û–ì–û** | **~6 —á–∞—Å–æ–≤** | ‚≠ê‚≠ê‚≠ê |

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
```bash
python -m py_compile src/ui/main_window/*.py
```

### 2. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
python app.py
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- ‚úÖ –û–∫–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ 3D —Å—Ü–µ–Ω–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ –ü–∞–Ω–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –°–∏–≥–Ω–∞–ª—ã –º–µ–∂–¥—É –ø–∞–Ω–µ–ª—è–º–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ QML –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

### 4. Unit —Ç–µ—Å—Ç—ã
```bash
python -m pytest tests/ui/test_main_window.py -v
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫
```bash
python tools/analyze_file_sizes.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
src/ui/main_window/main_window.py: ~300 —Å—Ç—Ä–æ–∫ ‚úÖ
src/ui/main_window/ui_setup.py: ~400 —Å—Ç—Ä–æ–∫ ‚úÖ
src/ui/main_window/qml_bridge.py: ~300 —Å—Ç—Ä–æ–∫ ‚úÖ
```

---

## üìã –ß–ï–ö–õ–ò–°–¢ –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
- [ ] –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `src/ui/main_window/`
- [ ] –°–æ–∑–¥–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ —Ñ–∞–π–ª—ã (8 —Ñ–∞–π–ª–æ–≤)
- [ ] –ü—Ä–æ—á–∏—Ç–∞–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
- [ ] –í—ã–¥–µ–ª–µ–Ω `ui_setup.py` (~400 —Å—Ç—Ä–æ–∫)
- [ ] –í—ã–¥–µ–ª–µ–Ω `qml_bridge.py` (~300 —Å—Ç—Ä–æ–∫)
- [ ] –í—ã–¥–µ–ª–µ–Ω `signals_router.py` (~200 —Å—Ç—Ä–æ–∫)
- [ ] –í—ã–¥–µ–ª–µ–Ω `state_sync.py` (~250 —Å—Ç—Ä–æ–∫)
- [ ] –í—ã–¥–µ–ª–µ–Ω `menu_actions.py` (~150 —Å—Ç—Ä–æ–∫)
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω `main_window.py` (~300 —Å—Ç—Ä–æ–∫)
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω `__init__.py` (fallback –º–µ—Ö–∞–Ω–∏–∑–º)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ (py_compile)
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [ ] 3D —Å—Ü–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–∞–Ω–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Unit —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω `README.md`
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω `REFACTORING_REPORT.md`
- [ ] –°–æ–∑–¥–∞–Ω –æ—Ç—á—ë—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –§–∞–∑—ã 2

---

## üéØ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

‚úÖ **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä < 400 —Å—Ç—Ä–æ–∫**
‚úÖ **–ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å < 500 —Å—Ç—Ä–æ–∫**
‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞**
‚úÖ **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫**
‚úÖ **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã**

---

## üìû –ü–û–ú–û–©–¨

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `REFACTORING_PHASE2_MAINWINDOW_PLAN.md` - –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω
- `REFACTORING_STATUS_VISUAL.txt` - –í–∏–∑—É–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç
- `src/ui/panels/graphics/README.md` - –ü—Ä–∏–º–µ—Ä –∏–∑ –§–∞–∑—ã 1

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
- `tools/analyze_file_sizes.py` - –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–æ–≤
- `python -m pytest tests/` - –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä—ã –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:
```python
# Coordinator Pattern (–∏–∑ GraphicsPanel)
class MainWindow(QMainWindow):
    def __init__(self):
        # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
        UISetup.setup_central(self)
        QMLBridge.setup_qml_view(self)
        SignalsRouter.connect_signals(self)

# State Manager Pattern
class StateSync:
    @staticmethod
    def update_from_snapshot(window, snapshot):
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        ...
```

---

## üöÄ –ù–ê–ß–ê–¢–¨!

```bash
# 1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
mkdir src/ui/main_window

# 2. –û—Ç–∫—Ä—ã—Ç—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
code src/ui/main_window

# 3. –°–ª–µ–¥–æ–≤–∞—Ç—å –ø–ª–∞–Ω—É
# REFACTORING_PHASE2_MAINWINDOW_PLAN.md

# 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
python app.py
```

---

## ‚úÖ –ì–û–¢–û–í!

**–§–∞–∑–∞ 2 –∑–∞–ø—É—â–µ–Ω–∞! –£–¥–∞—á–∏!** üöÄ

---

**–î–∞—Ç–∞:** 2025-01-XX
**–í–µ—Ä—Å–∏—è:** v4.9.5
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** ‚≠ê‚≠ê‚≠ê –í–´–°–û–ö–ò–ô
