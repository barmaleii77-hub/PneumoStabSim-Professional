# –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –î–£–ë–õ–ò–†–û–í–ê–ù–ò–Ø –°–û–ë–´–¢–ò–ô –ò –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï ExtendedSceneEnvironment

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **ExtendedSceneEnvironment –≤–º–µ—Å—Ç–æ SceneEnvironment**
**–§–∞–π–ª:** `assets/qml/main_optimized.qml`

**–ë–´–õ–û:**
```qml
environment: SceneEnvironment {
    backgroundMode: skyboxEnabled ? SceneEnvironment.SkyBox : SceneEnvironment.Color
    clearColor: backgroundColor

    antialiasingMode: antialiasingMode === 3 ? SceneEnvironment.ProgressiveAA :
                     antialiasingMode === 2 ? SceneEnvironment.MSAA :
                     antialiasingMode === 1 ? SceneEnvironment.SSAA :
                     SceneEnvironment.NoAA
}
```

**–°–¢–ê–õ–û:**
```qml
environment: ExtendedSceneEnvironment {
    backgroundMode: skyboxEnabled ? SceneEnvironment.SkyBox : SceneEnvironment.Color
    clearColor: backgroundColor
    lightProbe: iblEnabled ? null : null
    probeExposure: iblIntensity

    tonemapMode: tonemapEnabled ?
        (tonemapMode === 3 ? SceneEnvironment.TonemapModeFilmic :
         tonemapMode === 2 ? SceneEnvironment.TonemapModeReinhard :
         tonemapMode === 1 ? SceneEnvironment.TonemapModeLinear :
         SceneEnvironment.TonemapModeNone) : SceneEnvironment.TonemapModeNone
    exposure: 1.0
    whitePoint: 2.0

    antialiasingMode: antialiasingMode === 3 ? SceneEnvironment.ProgressiveAA :
                     antialiasingMode === 2 ? SceneEnvironment.MSAA :
                     antialiasingMode === 1 ? SceneEnvironment.SSAA :
                     SceneEnvironment.NoAA

    specularAAEnabled: true
    ditheringEnabled: true
    fxaaEnabled: true
    temporalAAEnabled: isRunning

    aoEnabled: ssaoEnabled
    aoStrength: ssaoIntensity * 100
    aoDistance: ssaoRadius
    aoSoftness: 20
    aoDither: true
    aoSampleRate: 3

    glowEnabled: bloomEnabled
    glowIntensity: bloomIntensity
    glowBloom: 0.5
    glowStrength: 0.8
    glowQualityHigh: true
    glowUseBicubicUpscale: true
    glowHDRMinimumValue: bloomThreshold
    glowHDRMaximumValue: 8.0
    glowHDRScale: 2.0

    lensFlareEnabled: lensFlareEnabled
    lensFlareGhostCount: 3
    lensFlareGhostDispersal: 0.6
    lensFlareHaloWidth: 0.25
    lensFlareBloomBias: 0.35
    lensFlareStretchToAspect: 1.0

    depthOfFieldEnabled: depthOfFieldEnabled
    depthOfFieldFocusDistance: dofFocusDistance
    depthOfFieldFocusRange: dofFocusRange
    depthOfFieldBlurAmount: 3.0

    vignetteEnabled: vignetteEnabled
    vignetteRadius: 0.4
    vignetteStrength: vignetteStrength

    colorAdjustmentsEnabled: true
    adjustmentBrightness: 1.0
    adjustmentContrast: 1.05
    adjustmentSaturation: 1.05
}
```

### 2. **–£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Mouse Event Handlers**
**–§–∞–π–ª:** `assets/qml/main_optimized.qml`

**–ë–´–õ–û:** –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º—ã—à–∏
**–°–¢–ê–õ–û:** –ï–¥–∏–Ω—ã–π MouseArea —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:

```qml
MouseArea {
    anchors.fill: parent
    hoverEnabled: true
    acceptedButtons: Qt.LeftButton | Qt.RightButton

    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ï–¥–∏–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ onPressed –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
    onPressed: (mouse) => {
        if (root.mouseDown) return // –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

        root.mouseDown = true
        root.mouseButton = mouse.button
        root.lastX = mouse.x
        root.lastY = mouse.y

        console.log("Mouse pressed: button =", mouse.button, "at", mouse.x, mouse.y)
    }

    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
}
```

### 3. **–£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫ –≥–µ–æ–º–µ—Ç—Ä–∏–∏**
**–§–∞–π–ª:** `assets/qml/main_optimized.qml`

**–ë–´–õ–û:**
```qml
onRodLengthErrorChanged: {
    if (rodLengthError > 1.0) {
        console.warn("‚ö†Ô∏è Rod length error:", rodLengthError.toFixed(2), "mm")
    }
}
```

**–°–¢–ê–õ–û:**
```qml
Component.onCompleted: {
    if (rodLengthError > 1.0) {
        console.warn("‚ö†Ô∏è Corner initialized with rod length error:", rodLengthError.toFixed(2), "mm")
    }
}
```

### 4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤ –º—ã—à–∏**
**–§–∞–π–ª:** `assets/qml/main_optimized.qml`

**–ë–´–õ–û:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è mouse state –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
**–°–¢–ê–õ–û:** –ï–¥–∏–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:

```qml
// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ mouse state - —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
property bool mouseDown: false
property int mouseButton: 0
property real lastX: 0
property real lastY: 0
property real rotateSpeed: 0.35
```

### 5. **–î–æ–±–∞–≤–ª–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥ –≤ GeometryPanel**
**–§–∞–π–ª:** `src/ui/panels/panel_geometry.py`

**–ü–†–û–ë–õ–ï–ú–ê:** AttributeError: 'GeometryPanel' object has no attribute '_on_link_rod_diameters_toggled'

**–†–ï–®–ï–ù–ò–ï:** –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥:
```python
@Slot(bool)
def _on_link_rod_diameters_toggled(self, checked: bool):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –¥–∏–∞–º–µ—Ç—Ä–æ–≤ —à—Ç–æ–∫–æ–≤"""
    print(f"üîó GeometryPanel: –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –¥–∏–∞–º–µ—Ç—Ä–æ–≤ —à—Ç–æ–∫–æ–≤: {'–≤–∫–ª—é—á–µ–Ω–æ' if checked else '–≤—ã–∫–ª—é—á–µ–Ω–æ'}")

    if checked:
        current_rod_diameter = self.parameters.get('rod_diameter_m', 0.035)
        print(f"   üîß –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –¥–∏–∞–º–µ—Ç—Ä—ã —à—Ç–æ–∫–æ–≤ –Ω–∞ {current_rod_diameter*1000:.1f}–º–º")
        self.status_message = "–î–∏–∞–º–µ—Ç—Ä—ã —à—Ç–æ–∫–æ–≤ —Å–≤—è–∑–∞–Ω—ã"
    else:
        print(f"   üîì –î–∏–∞–º–µ—Ç—Ä—ã —à—Ç–æ–∫–æ–≤ —Ç–µ–ø–µ—Ä—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã")
        self.status_message = "–î–∏–∞–º–µ—Ç—Ä—ã —à—Ç–æ–∫–æ–≤ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã"

    self.parameter_changed.emit('link_rod_diameters', float(checked))
```

### 6. **–û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –≤ app.py**
**–§–∞–π–ª:** `app.py`

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** –°—Ç—Ä–æ–∫–∏ –≤—ã–≤–æ–¥–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ExtendedSceneEnvironment:
```python
print("PNEUMOSTABSIM STARTING (ExtendedSceneEnvironment v4.3)")
print(f"QML file: main_optimized.qml (ExtendedSceneEnvironment)")
print(f"‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø: ExtendedSceneEnvironment + —É–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π")
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ:**
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –º—ã—à–∏** - —Ç–µ–ø–µ—Ä—å –µ–¥–∏–Ω—ã–π MouseArea
2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –≥–µ–æ–º–µ—Ç—Ä–∏–∏** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ Component.onCompleted
3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤ –º—ã—à–∏** - –µ–¥–∏–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
4. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥** - –¥–æ–±–∞–≤–ª–µ–Ω _on_link_rod_diameters_toggled
5. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π SceneEnvironment** - –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ ExtendedSceneEnvironment

### ‚úÖ **–ù–æ–≤—ã–µ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
1. **ExtendedSceneEnvironment** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã:
   - **Bloom** —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –ø–æ—Ä–æ–≥–æ–º
   - **SSAO** —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —Ä–∞–¥–∏—É—Å–æ–º
   - **Depth of Field** —Å —Ñ–æ–∫—É—Å–æ–º
   - **Vignette** —ç—Ñ—Ñ–µ–∫—Ç
   - **Lens Flare** —ç—Ñ—Ñ–µ–∫—Ç—ã
   - **Tonemap** —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏
   - **Temporal AA** –≤–æ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏

2. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - —É–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
3. **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞:
```bash
# –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (–∞–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫)
py app.py --test-mode

# –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ä–µ–∂–∏–º
py app.py --no-block

# –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º
py app.py
```

### ‚úÖ **–í—Å–µ —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ExtendedSceneEnvironment –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- –í—Å–µ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- 3D —Å—Ü–µ–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –°–æ–±—ã—Ç–∏—è –º—ã—à–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫:** 5
- **–£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–π –∫–æ–¥–∞:** 4
- **–î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π:** 10+ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- **–†–∞–∑–º–µ—Ä main_optimized.qml:** 55,116 –±–∞–π—Ç
- **–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏:** ‚úÖ Status.Ready

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–æ–±—ã—Ç–∏–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ SceneEnvironment –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π ExtendedSceneEnvironment —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π.

**–°—Ç–∞—Ç—É—Å:** üü¢ **–í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –£–°–ü–ï–®–ù–û –ü–†–ò–ú–ï–ù–ï–ù–´**
