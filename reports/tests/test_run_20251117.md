# Test & analysis summary — 2025-11-17

## Commands executed
- `make check` (uv-managed) — ran environment validation, Ruff/flake8, mypy, qmllint, Bandit, HDR verification, and pytest suites (unit, integration, UI) with coverage aggregation. Suite failed in the UI stage.
- `uv run ruff check app.py src tests tools` — style check passed.
- `uv run mypy --config-file mypy.ini $(cat mypy_targets.txt)` — type check passed.
- `uv run bash -c 'while read -r f; do [ -n "$f" ] && pyside6-qmllint "$f"; done < qmllint_targets.txt'` — linted QML targets; warnings captured in `reports/tests/qmllint_20251117.log` (not checked into VCS).
- `QT_QPA_PLATFORM=offscreen QT_QUICK_CONTROLS_STYLE=Basic PYTEST_QT_API=pyside6 PYTEST_DISABLE_PLUGIN_AUTOLOAD=1 uv run coverage run -m pytest -vv` — full headless pytest with coverage; aborted due to Qt crash in `test_canvas_animation_preview_window_visible`.
- `xvfb-run -a env QT_QPA_PLATFORM=xcb QT_QUICK_CONTROLS_STYLE=Basic PYTEST_QT_API=pyside6 PYTEST_DISABLE_PLUGIN_AUTOLOAD=1 uv run pytest -vv tests/ui/test_main_qml_structure.py --maxfail=1` — headed QML smoke sanity check passed.

## Pytest outcomes
- `make check` UI failures: `tests/ui/panels/test_panel_history.py::test_geometry_panel_registered_preset`, `tests/ui/test_canvas_animation_preview.py::test_canvas_animation_renders_and_updates`, `tests/ui/test_graphics_panel_legacy_fallback.py::test_graphics_panel_hydrates_missing_categories`, `tests/ui/test_main_qml_screenshots.py::{test_main_scene_matches_default_baseline,test_main_scene_animation_running_baseline}`, `tests/ui/test_post_effects_bypass_fail_safe.py::test_post_effects_bypass_triggers_view_effects_reset`, `tests/ui/test_shared_materials_fallback.py::test_assets_loader_switches_to_fallback_when_source_missing`, and missing fixture `training_preset_bridge` in `tests/ui/test_training_panel_integration.py::test_training_panel_loads_presets`.
- Headless coverage run aborted at `tests/ui/test_canvas_animation_preview.py::test_canvas_animation_preview_window_visible` (fatal Qt abort while creating QQuickView offscreen). Coverage data from prior stages remains available.
- Headed smoke (`tests/ui/test_main_qml_structure.py`) succeeded under Xvfb, confirming QML import paths resolve in a display-capable session.

## Coverage highlights for critical domains
- Physics: `src/physics/forces.py` 92.49%; `src/physics/integrator.py` 80.87%; `src/physics/odes.py` 80.00%; `src/physics/pneumo_system.py` 28.66% (needs improvement for runtime plumbing); UI physics tab (`src/ui/panels/modes/physics_tab.py`) 8.02%.
- HDR: `src/ui/main_window_pkg/_hdr_paths.py` 75.86% (path normalization); `src/ui/panels/graphics/hdr_discovery.py` 86.84% (asset discovery safeguards).
- Reflection-specific modules are not reported separately in the coverage JSON (implemented as settings fields rather than dedicated modules).

## Artefacts
- Updated JUnit reports: `reports/tests/unit.xml`, `reports/tests/integration.xml`, `reports/tests/ui.xml` (capture failing cases).
- Coverage JSON snapshot: `reports/quality/coverage.json` with full per-file metrics.
- QML lint warnings stored locally in `reports/tests/qmllint_20251117.log` for follow-up.
