# ‚úÖ –ú–ê–¢–ï–†–ò–ê–õ–´: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ò –°–û–•–†–ê–ù–ï–ù–ò–Ø - –ö–†–ê–¢–ö–û–ï –†–ï–ó–Æ–ú–ï

**–î–∞—Ç–∞:** 2025-01-12  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  

---

## üêõ –ü–†–û–ë–õ–ï–ú–ê

–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ –≤ `MaterialsTab` –∫–æ–Ω—Ç—Ä–æ–ª—ã (—Å–ª–∞–π–¥–µ—Ä—ã, —Ü–≤–µ—Ç–∞) **–ù–ï –ú–ï–ù–Ø–õ–ò–°–¨** –≤–∏–∑—É–∞–ª—å–Ω–æ, —Ö–æ—Ç—è –¥–∞–Ω–Ω—ã–µ –≤ JSON –±—ã–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏.

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í—ã–±–∏—Ä–∞—é "–†–∞–º–∞" ‚Üí opacity –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å 0.29, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 1.0
- –í—ã–±–∏—Ä–∞—é "–†—ã—á–∞–≥" ‚Üí opacity –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å 1.0, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0.29

---

## üîç ROOT CAUSE

### –§–∞–π–ª: `src/ui/panels/graphics/materials_tab.py`

```python
# ‚ùå –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
def _on_material_selection_changed(self, index: int) -> None:
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¢–ï–ö–£–©–ï–ï —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –ü–ï–†–ï–î –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º
    if self._current_key:
        self._save_current_into_cache()  # ‚Üê –ë–ê–ì!
        # –≠—Ç–æ –ü–ï–†–ï–ó–ê–ü–ò–°–´–í–ê–ï–¢ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫—ç—à–µ!
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª
    new_key = self.get_current_material_key()
    st = self._materials_state.get(new_key)
    if st:
        self._apply_controls_from_state(st)
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
1. –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å "–†–∞–º–∞" (opacity 0.29) –Ω–∞ "–†—ã—á–∞–≥" (opacity 1.0):
   - –ö–æ–Ω—Ç—Ä–æ–ª —Å–ª–∞–π–¥–µ—Ä–∞ **–£–ñ–ï** –Ω–∞ 0.29 (–æ—Ç "–†–∞–º–∞")
   - –ú–µ—Ç–æ–¥ `_save_current_into_cache()` —á–∏—Ç–∞–µ—Ç **–¢–ï–ö–£–©–ï–ï** –∑–Ω–∞—á–µ–Ω–∏–µ (0.29)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç 0.29 –≤ –∫—ç—à –¥–ª—è "–†–∞–º–∞" ‚úÖ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç "–†—ã—á–∞–≥" –∏–∑ –∫—ç—à–∞ (1.0) ‚úÖ

2. –ü—Ä–∏ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å "–†—ã—á–∞–≥" (1.0) –Ω–∞ "–†–∞–º–∞" (0.29):
   - –ö–æ–Ω—Ç—Ä–æ–ª —Å–ª–∞–π–¥–µ—Ä–∞ **–£–ñ–ï** –Ω–∞ 1.0 (–æ—Ç "–†—ã—á–∞–≥")
   - –ú–µ—Ç–æ–¥ `_save_current_into_cache()` —á–∏—Ç–∞–µ—Ç **–¢–ï–ö–£–©–ï–ï** –∑–Ω–∞—á–µ–Ω–∏–µ (1.0)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç 1.0 –≤ –∫—ç—à –¥–ª—è "–†—ã—á–∞–≥" ‚úÖ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
   - –ù–û **–ü–ï–†–ï–î –≠–¢–ò–ú** –∫—ç—à "–†–∞–º–∞" —É–∂–µ –±—ã–ª –∏—Å–ø–æ—Ä—á–µ–Ω –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —à–∞–≥–µ!

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

```python
// ‚úÖ –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
def _on_material_selection_changed(self, index: int) -> None:
    # ‚ùå –£–î–ê–õ–ï–ù–û: –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏!
    # –ö–æ–Ω—Ç—Ä–æ–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å –≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
    
    # ‚úÖ –¢–û–õ–¨–ö–û –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∏–∑ –∫—ç—à–∞
    new_key = self.get_current_material_key()
    st = self._materials_state.get(new_key)
    if st:
        self._apply_controls_from_state(st)
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¢–û–õ–¨–ö–û –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
    # (–≤ –º–µ—Ç–æ–¥–µ _on_control_changed)
```

**–õ–æ–≥–∏–∫–∞:**
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** –º–µ–∂–¥—É –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ ‚Üí **–¢–û–õ–¨–ö–û –ó–ê–ì–†–£–ó–ö–ê** –∏–∑ –∫—ç—à–∞
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ** –∫–æ–Ω—Ç—Ä–æ–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ‚Üí **–°–û–•–†–ê–ù–ï–ù–ò–ï** –≤ –∫—ç—à + —Å–∏–≥–Ω–∞–ª

---

## üìä –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### –§–∞–π–ª: `src/common/settings_manager.py`

```python
# ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: –ó–∞—â–∏—Ç–∞ –æ—Ç –º—É—Ç–∞—Ü–∏–π
def get_category(self, category: str, default: Any = None) -> Any:
    result = self._settings["current"].get(category, default)
    if isinstance(result, dict):
        return copy.deepcopy(result)  # ‚Üê –ö–û–ü–ò–Ø –≤–º–µ—Å—Ç–æ —Å—Å—ã–ª–∫–∏!
    return result
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π –º—É—Ç–∞—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ state —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫–∏
- –ì–∞—Ä–∞–Ω—Ç–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∫—ç—à–∞ –∫–∞–∂–¥–æ–π –ø–∞–Ω–µ–ª–∏

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—ã –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ **–ö–û–†–†–ï–ö–¢–ù–û –ú–ï–ù–Ø–Æ–¢–°–Ø** –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –¥—Ä—É–≥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞  
‚úÖ –ö–∞–∂–¥—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–≤–æ–∏ **–£–ù–ò–ö–ê–õ–¨–ù–´–ï** –ø–∞—Ä–∞–º–µ—Ç—Ä—ã  
‚úÖ –ó–Ω–∞—á–µ–Ω–∏—è **–ù–ï –ü–ï–†–ï–ó–ê–ü–ò–°–´–í–ê–Æ–¢–°–Ø** –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏  

**–¢–ï–°–¢–´:**
```
1. –í—ã–±—Ä–∞—Ç—å "–†–∞–º–∞" ‚Üí opacity –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0.29 ‚úÖ
2. –ò–∑–º–µ–Ω–∏—Ç—å opacity –Ω–∞ 0.50 ‚úÖ
3. –í—ã–±—Ä–∞—Ç—å "–†—ã—á–∞–≥" ‚Üí opacity –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 1.0 ‚úÖ
4. –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ "–†–∞–º–∞" ‚Üí opacity –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0.50 ‚úÖ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!)
```

---

## üìù –§–ê–ô–õ–´ –ò–ó–ú–ï–ù–ï–ù–´

1. **`src/ui/panels/graphics/materials_tab.py`**
   - –£–¥–∞–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ (`_on_material_selection_changed`)

2. **`src/common/settings_manager.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω `copy.deepcopy()` –≤ `get_category()`

3. **`src/ui/panels/graphics/widgets.py`**
   - –£–±—Ä–∞–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üõ°Ô∏è –ü–†–û–í–ï–†–ö–ê –û–°–¢–ê–õ–¨–ù–´–• –ü–ê–ù–ï–õ–ï–ô

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** 10 –ø–∞–Ω–µ–ª–µ–π  
**–ü—Ä–æ–±–ª–µ–º:** 0 (–≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã)  

–ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç: `PANELS_AUDIT_REPORT.md`

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ü–†–û–í–ï–†–ï–ù–û**  
**–í–µ—Ä—Å–∏—è:** v4.9.5+fix  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 100% üéâ
