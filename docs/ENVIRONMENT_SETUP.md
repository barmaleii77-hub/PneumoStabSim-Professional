# ENVIRONMENT_SETUP.md ‚Äî Qt –∏ Python –æ–∫—Ä—É–∂–µ–Ω–∏–µ

–î–æ–∫—É–º–µ–Ω—Ç –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å–≤–µ–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–Ω—å—à–µ –±—ã–ª–∏ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ `docs/run.md`,
`.github/copilot-instructions.md`, `docs/TROUBLESHOOTING.md` –∏ –æ—Ç—á—ë—Ç–∞–º –æ–±
–æ–∫—Ä—É–∂–µ–Ω–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –∫–∞–∫ –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –ø—Ä–∞–≤–¥—ã –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–∞–±–æ—á–∏—Ö –∏
headless-–ø—Ä–æ—Ñ–∏–ª–µ–π.

## 1. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ Python/Qt

| –ü—Ä–æ—Ñ–∏–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | Python | PySide6/QtQuick3D | NumPy | SciPy | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
| --- | --- | --- | --- | --- | --- | --- |
| **–û—Å–Ω–æ–≤–Ω–æ–π** | –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, CI | 3.13.x | 6.10.0 | 2.0.1 | 1.13.1 | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `make uv-sync` –∏ `python tools/setup_qt.py --qt-version 6.10.0`. |
| **LTS** | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–µ–∂–Ω–∏—Ö –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–π | 3.11.x | 6.5.3 | 1.24.4 | 1.11.4 | –¢—Ä–µ–±—É–µ—Ç extras-–ø—Ä–æ—Ñ–∏–ª—è `pneumostabsim[qt65]`. |
| **Legacy** | –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π | 3.12.x | 6.8.1 | 1.26.4 | 1.12.0 | –ù–µ –≤—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `uv`-–ø—Ä–æ—Ñ–∏–ª—å, —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤—Ä—É—á–Ω—É—é. |

> üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (PySide6 6.6/6.7/6.9) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ
> best-effort. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ extras (`.[qt66]`, `.[qt69]`) –∏ —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ
> —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `reports/quality/environment_setup_report.md`.

## 2. –ë–∞–∑–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Qt

–≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è `src/bootstrap/environment.py` –∏
–ø—Ä–æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `env.sample`. –ü—Ä–∏ —Ä—É—á–Ω–æ–º –∑–∞–ø—É—Å–∫–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- | --- |
| `QSG_RHI_BACKEND` | `opengl` | –ï–¥–∏–Ω—ã–π backend –¥–ª—è Windows, Linux –∏ macOS –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. |
| `QT_QUICK_CONTROLS_STYLE` | `Fusion` | –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –≤–µ–∑–¥–µ. |
| `QSG_OPENGL_VERSION` | `3.3` | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è OpenGL. |
| `QT_OPENGL` | `desktop` | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ desktop OpenGL. |
| `QSG_INFO` | `0` | –û—Ç—Å–µ—á–∫–∞ —à—É–º–Ω—ã—Ö –ª–æ–≥–æ–≤ —Å—Ü–µ–Ω—ã. |
| `QT_LOGGING_RULES` | `*.debug=false;*.info=false` | –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è Qt. |
| `QT_AUTO_SCREEN_SCALE_FACTOR` | `1` | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ HiDPI. |
| `QT_SCALE_FACTOR_ROUNDING_POLICY` | `PassThrough` | –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ UI. |
| `QT_ENABLE_HIGHDPI_SCALING` | `1` | –í–∫–ª—é—á–µ–Ω–∏–µ HiDPI. |
| `QT_ASSUME_STDERR_HAS_CONSOLE` | `1` | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è stderr. |
| `PSS_DIAG` | `1` | –í–∫–ª—é—á–µ–Ω–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–∞–Ω–∞–ª–∞ —Å–∏–º—É–ª—è—Ç–æ—Ä–∞. |

## 3. Headless –∏ Vulkan —Å—Ü–µ–Ω–∞—Ä–∏–∏

| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏ |
| --- | --- | --- |
| **Linux headless (CI, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)** | `QT_QPA_PLATFORM=offscreen`, `QT_QUICK_BACKEND=software`, `LIBGL_ALWAYS_SOFTWARE=1` | –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `DISPLAY` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ö–æ–º–∞–Ω–¥–∞ `make uv-run CMD="pytest -q"` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –ø—Ä–æ—Ñ–∏–ª—å. |
| **Vulkan smoke** | `QSG_RHI_BACKEND=vulkan`, `VK_ICD_FILENAMES=/usr/share/vulkan/icd.d/lvp_icd.x86_64.json` | –ü—É—Ç—å –∫ ICD –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `ls /usr/share/vulkan/icd.d/`. –î–ª—è headless –¥–æ–±–∞–≤—å—Ç–µ `QT_QPA_PLATFORM=offscreen`. |
| **Windows ANGLE fallback** | `QT_QPA_PLATFORM=windows`, `QT_OPENGL=angle` | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –¥—Ä–∞–π–≤–µ—Ä–∞–º–∏ OpenGL. –í–æ–∑–≤—Ä–∞—â–∞—è—Å—å –∫ GPU, —É–¥–∞–ª–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ `QT_OPENGL=desktop`. |
| **Safe mode (software-only)** | `LIBGL_ALWAYS_SOFTWARE=1`, `QT_QUICK_BACKEND=software` | –í Python –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `configure_qt_environment(safe_mode=True)`; –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Ö–≤–∞—Ç—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. |

## 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. `make uv-sync` –∏–ª–∏ `python -m tools.task_runner uv-sync` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
   –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
2. `python tools/setup_qt.py --qt-version 6.10.0` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Qt Quick 3D.
3. `make check` ‚Äî –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (`ruff`, `mypy`, `pytest`, `qmllint`).
4. `python -m tools.environment.verify_qt_setup --expected-version 6.10` ‚Äî
   —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ PySide6 –Ω–∞–π–¥–µ–Ω –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ü–µ–ª–µ–≤–æ–π –≤–µ—Ä—Å–∏–∏.
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—ã–≤–æ–¥ –≤ `reports/quality/environment_setup_report.md` –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
   –ø—Ä–æ—Ñ–∏–ª–µ–π.

### –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- Linux/macOS:

  ```sh
  make cross-platform-prep
  make cross-platform-test
  ```

- Windows / —Å—Ä–µ–¥—ã –±–µ–∑ `make`:

  ```powershell
  python -m tools.task_runner cross-platform-prep -- --qt-version 6.10.0
  python -m tools.task_runner cross-platform-test -- --pytest-args tests
  ```

–°–∫—Ä–∏–ø—Ç `tools/cross_platform_test_prep.py` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤,
–∏–º–ø–æ—Ä—Ç PySide6/`pytest-qt` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç headless-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Qt
(`QT_QPA_PLATFORM=offscreen`, `QT_QUICK_BACKEND=software` –¥–ª—è Linux,
`QSG_RHI_BACKEND=d3d11` –¥–ª—è Windows). –í—ã–ø–æ–ª–Ω—è–π—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –ø–æ—Å–ª–µ **–∫–∞–∂–¥–æ–≥–æ**
–∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–∏—Ç–µ—Ç —Ç–µ—Å—Ç–æ–≤ –º–µ–∂–¥—É –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏. –ù–∞—á–∏–Ω–∞—è —Å
–≤–µ—Ä—Å–∏–∏ 4.9.8 —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–∞–Ω–Ω–µ—Ä –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç GUI/QML-—Ç–µ—Å—Ç—ã –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏
–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ‚Äî –æ–Ω –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ–≥–æ–Ω —Å –æ—à–∏–±–∫–æ–π –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å
`python -m tools.cross_platform_test_prep --use-uv`, –ø–æ—ç—Ç–æ–º—É –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Qt –∏–ª–∏
`pytest-qt` –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã—è–≤–ª—è–µ—Ç—Å—è.

## 5. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏–∑ VS Code –∏–ª–∏ Copilot GPT —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `make cipilot-env`,
  –∑–∞—Ç–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env.cipilot` (`source ./.env.cipilot`).
- –î–ª—è headless —Ç–µ—Å—Ç–æ–≤ `pytest` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–ª–∞–≥ `--pss-headless` –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ
  `PSS_HEADLESS=1`; –æ–Ω –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –≤—ã—à–µ.
- –ü—Ä–∏ —Å–º–µ–Ω–µ backend (OpenGL ‚Üî Vulkan) –æ—á–∏—â–∞–π—Ç–µ –∫—ç—à Qt (`rm -rf ~/.cache/QtProject`)
  –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –ø—Ä–æ—à–ª–æ–π —Å–µ—Å—Å–∏–∏.
- –í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö;
  –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã —Å—Å—ã–ª–∞—Ç—å—Å—è –∏–º–µ–Ω–Ω–æ –Ω–∞ –Ω–µ–≥–æ.
