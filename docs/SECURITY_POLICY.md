# Политика безопасности PneumoStabSim Professional

## 1. Область действия

Документ определяет минимальные требования к управлению доступом, аудиту и
оперативному реагированию для учебно-симуляционной платформы PneumoStabSim
Professional. Политика распространяется на весь исходный код, настройки,
пользовательские профили и генерируемые отчетные артефакты.

## 2. Модель ролей

| Роль         | Описание | Основные права |
| ------------ | -------- | -------------- |
| **Администратор** | Ответственный за эксплуатацию и выпуск новых версий. | Полный доступ к настройкам, миграциям и административным API. |
| **Инструктор**    | Ведет учебные занятия и готовит сценарии. | Может менять параметры симуляции, камеры и среды, но не управляет глобальными миграциями. |
| **Гость**         | Демонстрационный режим или автономная витрина. | Только чтение. Изменения настроек запрещены. |

Ролевая модель реализована модулем `src/security/access_control.py` и
применяется в сервисах работы с настройками (`SettingsManager`) и UI (`VisualizationService`).

## 3. Управление доступом

1. Все попытки модификации настроек проходят проверку в
   `AccessControlService.require_permission` и логируются.
2. Права определяются списком разрешенных префиксов (`editable_prefixes`).
3. UI обязан использовать `VisualizationService.access_profile()` для включения
   или отключения элементов интерфейса в зависимости от активной роли.
4. Изменение роли фиксируется с указанием предыдущего значения и субъекта,
   вызвавшего смену.

## 4. Аудит и неизменяемость

1. Записи аудита сохраняются в `reports/security_audit/` в формате JSON Lines.
2. Каждый запись содержит хэш-цепочку (`hash`, `previous_hash`) для выявления
   попыток подмены.
3. Местоположение лога может быть переназначено переменной окружения
   `PSS_SECURITY_AUDIT_LOG`.
4. Проверка целостности выполняется методом `SecurityAuditLogger.verify_chain()`.

## 5. Операционные требования

- Любые изменения настроек должны сопровождаться идентификатором пользователя или
  сервиса (поле `actor`).
- Модули, работающие с настройками, не должны кешировать роли — только считывать
  актуальное состояние `AccessControlService`.
- Права по умолчанию — «гость». В production-окружениях роль администратора
  присваивается только аутентифицированным операторам.

## 6. Реагирование на инциденты

1. При обнаружении подозрительной записи аудита необходимо:
   - Извлечь логи за период, затронутый событием.
   - Проверить непрерывность хэш-цепочки.
   - Сравнить временные метки с системными журналами.
2. При нарушении целостности журнала запись считается недействительной, и
   требуется восстановить состояние из проверенного бэкапа.

## 7. Обновление политики

- Документ пересматривается после каждого релиза с изменениями в механизмах
  авторизации или аудита.
- Ответственный за актуальность: владелец продукта или назначенный администратор
  проекта.
