# CLI — ключи запуска и профили

Этот документ описывает поддерживаемые флаги командной строки и их влияние на
инициализацию Qt/Qt Quick 3D.

## Основные флаги

- `--no-qml`
  - Отключает загрузку QML/Qt Quick 3D сцены, но не мешает созданию
    `QApplication`. Используется для диагностики UI и запуска без 3D.
  - Отличается от `--safe`: последний переводит приложение в безопасный/головной
    режим, при котором главное окно не создаётся вовсе.

- `--safe` (alias bootstrap для `--test-mode`)
  - Включает безопасный/головной режим: главное окно не создаётся, приложение
    завершается сразу после инициализации.
  - Синоним к тестовому режиму на этапе bootstrap: в `parse_arguments` помечает
    `test_mode=True`.

- `--legacy`
  - Запуск старого интерфейса на Qt Widgets без загрузки QML.

- `--env-check`, `--env-report[=PATH]`
  - Ранние проверки окружения до импорта Qt (см. `tools/environment/verify_qt_setup.py`).

- `--verbose`, `--diag`
  - Подробные логи и пост‑диагностика логов после завершения.

## Типичные сценарии

- Диагностика UI без 3D (обычное окно, без QML):
  ```sh
  python app.py --no-qml
  ```

- Полностью безопасный headless-запуск (без окна):
  ```sh
  python app.py --safe
  ```

- Старый UI на Qt Widgets:
  ```sh
  python app.py --legacy
  ```

## Поведение `ApplicationRunner`

- При `--no-qml` флаг устанавливает `use_qml_3d_schema=False`. Главное окно
  создаётся, но сцена Qt Quick 3D пропускается. В логах появляется предупреждение
  `Qt Quick 3D disabled by --no-qml`.
- При `--legacy` также принудительно `use_qml_3d_schema=False`.
- При `--safe` не создаются ни окно, ни сцена; выполняется немедленное
  корректное завершение.

См. интеграционные тесты `tests/integration/test_no_qml_app_runner.py` и модульные
тесты парсера `tests/unit/cli/test_no_qml_flag.py`.
