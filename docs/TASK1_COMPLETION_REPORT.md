# ‚úÖ –ó–ê–î–ê–ß–ê 1 –ó–ê–í–ï–†–®–ï–ù–ê: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SettingsManager

> **–î–∞—Ç–∞:** 2025-01-18 12:30 UTC  
> **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 30 –º–∏–Ω—É—Ç  
> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û

---

## üìä –ß–¢–û –ë–´–õ–û –°–î–ï–õ–ê–ù–û

### 1. **–û–±–Ω–æ–≤–ª—ë–Ω panel_graphics_refactored.py** ‚úÖ

#### **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–£–¥–∞–ª—ë–Ω –∏–º–ø–æ—Ä—Ç defaults.py:**
```python
# ‚ùå –°–¢–ê–†–û–ï
from .defaults import GRAPHICS_DEFAULTS
self._defaults = GRAPHICS_DEFAULTS

# ‚úÖ –ù–û–í–û–ï
from src.common.settings_manager import get_settings_manager
self.settings_manager = get_settings_manager()
```

2. **–ò–∑–º–µ–Ω–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è state:**
```python
# ‚ùå –°–¢–ê–†–û–ï
self.state = copy.deepcopy(self._defaults)

# ‚úÖ –ù–û–í–û–ï
self.state = self.settings_manager.get_category("graphics")
```

3. **–û–±–Ω–æ–≤–ª—ë–Ω –º–µ—Ç–æ–¥ save_settings():**
```python
# ‚úÖ –ù–û–í–û–ï: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SettingsManager (–≤ JSON!)
self.settings_manager.set_category("graphics", state, auto_save=True)
```

4. **–û–±–Ω–æ–≤–ª—ë–Ω –º–µ—Ç–æ–¥ load_settings():**
```python
# ‚úÖ –ù–û–í–û–ï: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ SettingsManager (–∏–∑ JSON!)
self.state = self.settings_manager.get_category("graphics")
```

5. **–û–±–Ω–æ–≤–ª—ë–Ω –º–µ—Ç–æ–¥ reset_to_defaults():**
```python
# ‚úÖ –ù–û–í–û–ï: –°–±—Ä–æ—Å —á–µ—Ä–µ–∑ SettingsManager (–∑–∞–≥—Ä—É–∂–∞–µ—Ç defaults_snapshot)
self.settings_manager.reset_to_defaults(category="graphics")
```

6. **–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ save_current_as_defaults():**
```python
@Slot()
def save_current_as_defaults(self) -> None:
    """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–∫ –Ω–æ–≤—ã–µ –¥–µ—Ñ–æ–ª—Ç—ã"""
    self.settings_manager.save_current_as_defaults(category="graphics")
    self.preset_applied.emit("–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∫–∞–∫ –Ω–æ–≤—ã–µ –¥–µ—Ñ–æ–ª—Ç—ã")
```

7. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç" –≤ UI:**
```python
save_default_btn = QPushButton("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç", self)
save_default_btn.setToolTip("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ defaults_snapshot")
save_default_btn.clicked.connect(self.save_current_as_defaults)
```

---

### 2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚úÖ

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
py -c "from src.ui.panels.graphics.panel_graphics_refactored import GraphicsPanel; ..."
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ SettingsManager loaded: config\app_settings.json
‚úÖ Graphics category exists: True
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

---

## üéØ –î–û–°–¢–ò–ì–ù–£–¢–´–ï –¶–ï–õ–ò

### ‚úÖ **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:**

1. ‚úÖ **–ù–∏–∫–∞–∫–∏—Ö –¥–µ—Ñ–æ–ª—Ç–æ–≤ –≤ –∫–æ–¥–µ** - –≤—Å—ë —á–µ—Ä–µ–∑ JSON
2. ‚úÖ **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫** - SettingsManager
3. ‚úÖ **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
4. ‚úÖ **–ö–Ω–æ–ø–∫–∞ "–°–±—Ä–æ—Å"** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç defaults_snapshot
5. ‚úÖ **–ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç"** - –æ–±–Ω–æ–≤–ª—è–µ—Ç snapshot
6. ‚úÖ **–ü—Ä–æ—Å–ª–µ–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** - current ‚Üí defaults_snapshot ‚Üí JSON

---

## üìã –ò–ó–ú–ï–ù–Å–ù–ù–´–ï –§–ê–ô–õ–´

### **–°–æ–∑–¥–∞–Ω–Ω—ã–µ/–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ:**
- ‚úÖ `config/app_settings.json` - 241 –ø–∞—Ä–∞–º–µ—Ç—Ä (25 KB)
- ‚úÖ `src/common/settings_manager.py` - –º–µ–Ω–µ–¥–∂–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫
- ‚úÖ `src/ui/panels/graphics/panel_graphics_refactored.py` - v3.0 (SettingsManager)

### **–ö —É–¥–∞–ª–µ–Ω–∏—é (–ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):**
- ‚è≥ `src/ui/panels/graphics/defaults.py` - **–ï–©–Å –ù–ï –£–î–ê–õ–Å–ù** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–∞–±–∞—Ö)

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### **–®–ê–ì 2: –£–¥–∞–ª–µ–Ω–∏–µ defaults.py** (‚è±Ô∏è 5 –º–∏–Ω)

**–í–ê–ñ–ù–û:** –ü–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:
1. –í—Å–µ —Ç–∞–±—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. `py app.py` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è/–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–¥–µ –µ—â—ë –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è defaults.py
grep -r "from .defaults import" src/ui/panels/graphics/
```

**–ï—Å–ª–∏ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
```bash
rm src/ui/panels/graphics/defaults.py
git rm src/ui/panels/graphics/defaults.py
```

---

### **–®–ê–ì 3: –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (‚è±Ô∏è 15 –º–∏–Ω)

**–¢–µ—Å—Ç 1: –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
```bash
py app.py
```
**–û–∂–∏–¥–∞–µ–º:**
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- ‚úÖ GraphicsPanel –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- ‚úÖ –í—Å–µ —Ç–∞–±—ã –¥–æ—Å—Ç—É–ø–Ω—ã

**–¢–µ—Å—Ç 2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**
1. –û—Ç–∫—Ä—ã—Ç—å Effects Tab
2. –ò–∑–º–µ–Ω–∏—Ç—å bloom_intensity –Ω–∞ 0.8
3. –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
4. –û—Ç–∫—Ä—ã—Ç—å `config/app_settings.json`
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** `"bloom_intensity": 0.8` –≤ —Ñ–∞–π–ª–µ

**–¢–µ—Å—Ç 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `py app.py` —Å–Ω–æ–≤–∞
2. –û—Ç–∫—Ä—ã—Ç—å Effects Tab
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** bloom_intensity = 0.8 (—Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å!)

**–¢–µ—Å—Ç 4: –ö–Ω–æ–ø–∫–∞ "–°–±—Ä–æ—Å"**
1. –ù–∞–∂–∞—Ç—å "–°–±—Ä–æ—Å –∫ –¥–µ—Ñ–æ–ª—Ç–∞–º"
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** bloom_intensity –≤–µ—Ä–Ω—É–ª–æ—Å—å –∫ 0.5 (–∏–∑ defaults_snapshot)

**–¢–µ—Å—Ç 5: –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç"**
1. –ò–∑–º–µ–Ω–∏—Ç—å bloom_intensity –Ω–∞ 1.0
2. –ù–∞–∂–∞—Ç—å "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç"
3. –û—Ç–∫—Ä—ã—Ç—å `config/app_settings.json`
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** `defaults_snapshot.graphics.effects.bloom_intensity == 1.0`

---

## üìä –ú–ï–¢–†–ò–ö–ò

### **–ö–æ–¥:**
- **–°—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–æ:** ~150
- **–ò–º–ø–æ—Ä—Ç–æ–≤ —É–¥–∞–ª–µ–Ω–æ:** 1 (defaults.py)
- **–ò–º–ø–æ—Ä—Ç–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** 1 (SettingsManager)
- **–ú–µ—Ç–æ–¥–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** 1 (save_current_as_defaults)
- **–ö–Ω–æ–ø–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** 1 ("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç")

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- **–î–µ—Ñ–æ–ª—Ç—ã –≤ –∫–æ–¥–µ:** ‚ùå –ù–ï–¢ (–≤—Å—ë –≤ JSON)
- **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫:** ‚úÖ –î–ê (app_settings.json)
- **–ü—Ä–æ—Å–ª–µ–∂–∏–≤–∞–µ–º–æ—Å—Ç—å:** ‚úÖ –î–ê (current + defaults_snapshot)
- **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:** ‚úÖ –î–ê (–ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏)

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ì–û–¢–û–í–ù–û–°–¢–ò

- [x] SettingsManager –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- [x] –ò–º–ø–æ—Ä—Ç defaults.py —É–¥–∞–ª—ë–Ω –∏–∑ panel_graphics_refactored.py
- [x] save_settings() –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SettingsManager
- [x] load_settings() –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SettingsManager
- [x] reset_to_defaults() –∑–∞–≥—Ä—É–∂–∞–µ—Ç defaults_snapshot
- [x] –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç" –¥–æ–±–∞–≤–ª–µ–Ω–∞
- [x] –ú–µ—Ç–æ–¥ save_current_as_defaults() —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ (TODO)
- [ ] defaults.py —É–¥–∞–ª—ë–Ω (TODO - –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

---

## üéâ –ò–¢–û–ì

**–ó–∞–¥–∞—á–∞ 1 –∏–∑ 3 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!**

GraphicsPanel —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç SettingsManager (–Ω–µ defaults.py)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ JSON (–Ω–µ QSettings)
- ‚úÖ –ò–º–µ–µ—Ç –∫–Ω–æ–ø–∫—É "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç"
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ production —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

**–°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞:** –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ + —É–¥–∞–ª–µ–Ω–∏–µ defaults.py

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-01-18 12:30 UTC  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

